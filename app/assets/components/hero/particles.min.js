var bannerboy=bannerboy||{};bannerboy.Particle=function(){this.x=0,this.y=0,this.vx=0,this.vy=0,this.mass=0,this.radius=0,this.friction=0,this.springs=[],this.gravitations=[],this.rotation=0,this.rotationSpeed=0,this.scale=0,this.opacity=0,this.progress=0,this.lifespan},bannerboy.Particle.prototype.addSpring=function(t,e,i){this.removeSpring(t),this.springs.push({point:t,k:e,length:i||0})},bannerboy.Particle.prototype.removeSpring=function(t){for(var e=0;e<this.springs.length;++e)if(t===this.springs[e].point)return void this.springs.splice(e,1)},bannerboy.Particle.prototype.addGravitation=function(t){this.removeGravitation(t),this.gravitations.push(t)},bannerboy.Particle.prototype.removeGravitation=function(t){for(var e=0;e<this.gravitations.length;++e)if(t===this.gravitations[e])return void this.gravitations.splice(e,1)},bannerboy.Particle.prototype.accelerate=function(t,e){this.vx+=t,this.vy+=e},bannerboy.Particle.prototype.update=function(t){this.age++,this.progress=this.age/this.lifespan,this.handleSprings(),this.handleGravitations(),this.vx*=this.friction,this.vy*=this.friction,this.x+=this.vx,this.y+=this.vy,this.rotation+=this.rotationSpeed},bannerboy.Particle.prototype.handleGravitations=function(){for(var t=0;t<this.gravitations.length;++t)this.gravitateTo(this.gravitations[t])},bannerboy.Particle.prototype.handleSprings=function(){for(var t=0;t<this.springs.length;++t){var e=this.springs[t];this.springTo(e.point,e.k,e.length)}},bannerboy.Particle.prototype.gravitateTo=function(t){var e=t.x-this.x,i=t.y-this.y,s=e*e+i*i,r=Math.sqrt(s),n=t.mass/s,a=e/r*n,h=i/r*n;this.vx+=a,this.vy+=h},bannerboy.Particle.prototype.springTo=function(t,e,i){var s=t.x-this.x,r=t.y-this.y,n=Math.sqrt(s*s+r*r),a=(n-i||0)*e;this.vx+=s/n*a,this.vy+=r/n*a},bannerboy.Particle.prototype.getSpeed=function(){return Math.sqrt(this.vx*this.vx+this.vy*this.vy)},bannerboy.Particle.prototype.setSpeed=function(t){var e=this.getHeading();this.vx=Math.cos(e)*t,this.vy=Math.sin(e)*t},bannerboy.Particle.prototype.getHeading=function(){return Math.atan2(this.vy,this.vx)},bannerboy.Particle.prototype.setHeading=function(t){var e=this.getSpeed();this.vx=Math.cos(t)*e,this.vy=Math.sin(t)*e},bannerboy.Particle.prototype.getLifeCurve=function(){return Math.sin(this.progress*Math.PI)};var bannerboy=bannerboy||{};bannerboy.ParticleSystem=function(t){this.settings=bannerboy.combineObjects({preCalc:!1,autoStart:!0,gravity:.06,wind:0,turbulence:.1,friction:.97,vx:0,vy:0,areaPadding:50,opacity:1,scale:1,rotationSpeed:0,rotation:1,fps:60,reverseRender:!1},t),this.deleteProps=["preCalc","scale","rotation","opacity","reverseRender","images","clearCanvas","autoStart","emitter","onUpdate","onUpdateParticle","onUpdateParticles","onEmittParticle","renderParticle","renderParticles"],this.renderer=new bannerboy.ParticleRenderer(this.settings,this),this.emitter=this.settings.emitter||{x:0,y:0,width:this.renderer.width,height:this.renderer.height},this.settings.images&&(this.images=this.settings.images.slice()),this.onEmittParticle=this.settings.onEmittParticle,this.onUpdateParticle=this.settings.onUpdateParticle,this.onUpdateParticles=this.settings.onUpdateParticles,this.settings.renderParticle&&(this.renderer.renderParticle=this.settings.renderParticle),this.settings.renderParticles&&(this.renderer.renderParticles=this.settings.renderParticles),this.lifespan=this.settings.lifespan,this.maxParticles=this.settings.maxParticles,this.particlesPerSecond=this.settings.particlesPerSecond,this.maxParticles&&this.particlesPerSecond&&this.lifespan&&(this.lifespan=null,console.log("Particles: Lifespan changed to honor maxParticles & particlesPerSecond")),this.maxParticles||(this.maxParticles=this.lifespan*this.particlesPerSecond),this.particlesPerSecond||(this.particlesPerSecond=this.maxParticles/this.lifespan),this.lifespan||(this.lifespan=this.maxParticles/this.particlesPerSecond),console.log("Particles:\n	Renderer: "+this.renderer.type+"\n	Lifespan: "+this.lifespan+"\n	Max particles: "+this.maxParticles+"\n	Particles per second: "+this.particlesPerSecond),this.oldTime=(new Date).getTime()/1e3,this.lastEmittTime=this.oldTime,this.currentTime,this.fps=this.settings.fps,this.updateInterval=1/this.settings.fps,this.isRunning=!1,this.deltaTime,this.emittInterval=1/this.particlesPerSecond,this.particlesPerFrame=this.updateInterval/this.emittInterval,this.particleRest=0,this.activeParticles=[],this.idleParticles=[],this.images&&this.prepareImages();for(var e=0;e<this.maxParticles;++e){var i=new bannerboy.Particle(0,0,0,0);this.idleParticles.push(i),this.renderer.onCreateParticle&&this.renderer.onCreateParticle(i)}this.renderer.onInit&&this.renderer.onInit(this.idleParticles),this.settings.autoStart&&this.start()},bannerboy.ParticleSystem.prototype.start=function(){if(this.isRunning=!0,this.settings.preCalc)for(var t=this.lifespan*this.fps,e=0;t>e;++e)this.update(e+1);this.settings.preCalc=!1,TweenLite.ticker.addEventListener("tick",this.update,this)},bannerboy.ParticleSystem.prototype.stop=function(t){this.isRunning=!1,t&&(console.log("removeEventListener"),TweenLite.ticker.removeEventListener("tick",this.update))},bannerboy.ParticleSystem.prototype.prepareImages=function(){for(var t=0;t<this.images.length;++t){var e=new Image;e.src=this.images[t],this.images[t]=e}},bannerboy.ParticleSystem.prototype.update=function(t){if(this.currentTime=t?t*(1/60):(new Date).getTime()/1e3,this.deltaTime=this.currentTime-this.oldTime,t||60==this.fps||this.deltaTime>this.updateInterval){if(this.oldTime=this.currentTime-this.deltaTime%this.updateInterval,this.deltaTime>3*this.updateInterval)return;var e=this.particlesPerFrame+this.particleRest;this.particleRest=e%1,this.isRunning&&this.emittParticles(Math.floor(e)),this.onUpdateParticles&&this.onUpdateParticles(this.activeParticles);for(var i=this.activeParticles.length;i--;){var s=this.activeParticles[i];(this.settings.wind||this.settings.gravity)&&s.accelerate(this.settings.wind,this.settings.gravity),this.settings.turbulence&&s.accelerate(bannerboy.utils.randomRange(-this.settings.turbulence,this.settings.turbulence),bannerboy.utils.randomRange(-this.settings.turbulence,this.settings.turbulence)),this.onUpdateParticle&&this.onUpdateParticle(s),s.update(this.deltaTime),(s.x<-this.settings.areaPadding||s.x>this.renderer.width+this.settings.areaPadding||s.y<-this.settings.areaPadding||s.y>this.renderer.height+this.settings.areaPadding||s.age>this.lifespan*this.fps)&&(this.idleParticles.push(this.activeParticles.splice(i,1)[0]),this.renderer.onParticleDeath&&this.renderer.onParticleDeath(s))}this.renderer.renderParticles(this.settings.reverseRender?this.activeParticles.slice().reverse():this.activeParticles)}this.activeParticles.length||this.isRunning||this.stop(!0)},bannerboy.ParticleSystem.prototype.emittParticles=function(t){this.isRunning||(this.start(),this.isRunning=!1);for(var e=0;t>e;++e){var i=this.idleParticles.length?this.idleParticles.shift():this.activeParticles.shift();i.age=0,i.progress=0,i.lifeCurve=0,i.springs=[],i.gravitations=[],i.x=this.emitter.x+Math.random()*(this.emitter.width||0),i.y=this.emitter.y+Math.random()*(this.emitter.height||0),i.opacity=this.settings.opacity,i.lifespan=this.lifespan*this.fps,i.friction=this.settings.friction,i.rotationSpeed=this.settings.rotationSpeed,null!=this.settings.heading&&null!=this.settings.speed?(i.setSpeed(this.settings.speed),i.setHeading(this.settings.heading)):(i.vx=this.settings.vx,i.vy=this.settings.vy),i.scale=this.settings.scale,i.rotation=this.settings.rotation,this.images&&(i.img=this.images[bannerboy.utils.randomInt(0,this.images.length-1)]),this.onEmittParticle&&this.onEmittParticle(i),this.renderer.onEmittParticle&&this.renderer.onEmittParticle(i),this.activeParticles.push(i)}};var bannerboy=bannerboy||{};bannerboy.ParticleRenderer=function(t,e){if(this.type="Canvas",this.settings=t,this.system=e,!this.settings.canvas){this.settings.clearCanvas=!0;var i=document.getElementById("banner"),s={parent:i||document.body,width:i?i.get("width"):300,height:i?i.get("height"):250,type:"canvas"},r=bannerboy.combineObjects(s,this.settings);bannerboy.deleteProps(r,this.system.deleteProps),this.canvas=bannerboy.createElement(r)}this.ctx=this.canvas.getContext("2d"),this.width=this.canvas.width,this.height=this.canvas.height},bannerboy.ParticleRenderer.prototype.clearCanvas=function(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)},bannerboy.ParticleRenderer.prototype.renderParticles=function(t){this.settings.clearCanvas&&this.clearCanvas();for(var e=0;e<t.length;++e)this.renderParticle(t[e])},bannerboy.ParticleRenderer.prototype.renderParticle=function(t){if(t.img){this.ctx.save(),this.ctx.translate(t.x,t.y),this.ctx.rotate(t.rotation),this.ctx.scale=t.scale,this.ctx.globalAlpha=t.opacity;var e=t.img;this.ctx.drawImage(e,-e.width*t.scale/2,-e.height*t.scale/2,e.width*t.scale,e.height*t.scale),this.ctx.restore()}};